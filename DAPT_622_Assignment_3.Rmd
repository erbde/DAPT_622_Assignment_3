---
title: "DAPT 622 Assignment 3"
author: "Daniel Erb"
date: "March 2, 2019"
output: 
  pdf_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(dplyr)
library(knitr)
library(dendextend)
library(colormap)
library(factoextra)
library(ggplot2)
trip.advisor <- read.csv(file = 'Data/tripadvisor_review.csv')

```

# Part 1 - Cluster Analysis



## Section A 

Perform a heirarchical cluster analysis (via Ward's method) using all the variables except User ID.

```{r perform heirarchical cluster analysis, echo = FALSE}
trip.advisor <- trip.advisor %>% 
  rename(art.gals = Category.1,
         dnce.clb = Category.2,
         j.bars = Category.3,
         rest = Category.4,
         museums = Category.5,
         res = Category.6,
         park.pic = Category.7,
         beach = Category.8,
         theaters = Category.9,
         relig.inst = Category.10
         )

d <- dist(trip.advisor[,2:11],method="euclidean")
hier.clust <- hclust(d,method="ward.D")
```

### Subsection i

Select an appropriate number of clusters. Provide a dendrogram with the clusters highlighted.

```{r select clusters and provide dendrogram, echo = FALSE}
k.clusts <- 5
d <- dist(trip.advisor[,2:11],method="euclidean")
hier.clust <- hclust(d,method="ward.D")

dend <- d %>% 
  hclust(method="ward.D") %>% 
  as.dendrogram()

# Plot with Color in function of the cluster
leafcolor <- colormap(colormap = colormaps$jet ,
                      nshades = k.clusts, format = "hex",
                      alpha = 1, reverse = FALSE)
dend %>%
  set("labels_col", value = leafcolor, k=k.clusts) %>%
  set("branches_k_color", value = leafcolor, k = k.clusts) %>%
  plot(horiz=FALSE)

```

### Subsection ii

Provide a table summarizing the clusters via their means. Are there any distinguishing qualities regarding the clusters? 

```{r show averages, echo = FALSE}
groups <- cutree(hier.clust,k=k.clusts)
hier.vals <- as.data.frame(aggregate(trip.advisor[,2:11],list(groups),FUN=mean))
hier.vals <- rename(hier.vals, Cluster = Group.1)
kable(hier.vals, digits = 2, format = "markdown",  caption = "Hierarchical Groupings")
```

For this dataset, 5 clusters were chosen as they seem to separate the groups into by usable chunks without being too specific as to be confusing. When looking at the average scores for each type of destination, across the individuals of cluster 1, we see that they tend to rate dance clubs, museums, and restaurants more positively than the individuals within other clusters, while only giving lower scores to religious institutions. Cluster 2, seems to favor art galaries, while disfavoring dance clubs and theaters, when compared to the other clusters. For cluster 3, individiduals within this group tend to rate juice bars, museums and restaurants lower than other clusters, while rating religious institutions higher than others. Cluster 4 tended to give particularly low ratings to juice bars. This in contrast to rating restaurants and theaters higher than other clusters. Cluster 5 had an average rating for juice bars that tended to be one or two whole ratings higher. They also tended to rate religious institutions lower than other clusters. One intersting note for the averages, both beaches and parks seemed consistently rated across all the clusters.

### Subsection iii

Perform a “two-way” cluster analysis (i.e., cluster the variables) and provide the dendrogram showing the variable clusters and a heat map of the data. Which variables cluster together?

```{r variable clusters and heat map}
mydata <- as.matrix(trip.advisor[,2:11])
rownames(mydata) <- trip.advisor[,1]
datascaled <- scale(mydata)
heatmap(datascaled, col = colormap(colormap = colormaps$jet))
```

Parks and picnic areas clustered together with juice bars earlier than any other categories. The next to cluster to form was comprised of museums and restaurant ratings. These two clusters then clustered sooner than any other categories clustered wih any other categories. As we follow the tree upward, we see that beaches and theaters cluster together next, however the visual seems to give weeker evidence of this. 

## Section B

Now perform a k-means cluster analysis. Specify the same number of clusters as selected in part a).  Display the cluster summary including the cluster means.  Are different clusters produced than in part a)?  Describe what you see.

```{r kmeans clustering}


fviz_nbclust(trip.advisor[,2:11],kmeans,method="gap_stat")
kmean.clust <- kmeans(trip.advisor[,2:11],k.clusts)
agg.vals <- as.data.frame(aggregate(mydata,by=list(kmean.clust$cluster),FUN=mean))
agg.vals <- rename(agg.vals, Cluster = Group.1)
kable(agg.vals, digits = 2, format = "markdown",  caption = "K-Means Groupings")
fviz_cluster(kmean.clust,data=trip.advisor[,2:11],
             axes = c(1,2),
             ggtheme = theme_minimal())
fviz_cluster(kmean.clust,data=trip.advisor[,2:11],
             axes = c(1,3),
             ggtheme = theme_minimal())
fviz_cluster(kmean.clust,data=trip.advisor[,2:11],
             axes = c(2,3),
             ggtheme = theme_minimal())

trip.advisor1 <- cbind(trip.advisor,groups)
trip.advisor1 <- cbind(trip.advisor1,kmean.clust$cluster)
trip.advisor1 <- rename(trip.advisor1, hier.cluster = groups, k.cluster = kmeans.clust$cluster)
```
